<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - CipherVault</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0F172A;
      --secondary: #1E293B;
      --accent: #3B82F6;
      --accent-hover: #2563EB;
      --success: #10B981;
      --danger: #EF4444;
      --warning: #F59E0B;
      --text-primary: #0F172A;
      --text-secondary: #64748B;
      --bg-primary: #F8FAFC;
      --bg-secondary: #FFFFFF;
      --border: #E2E8F0;
      --shadow: rgba(15, 23, 42, 0.1);
    }
    
    [data-theme="dark"] {
      --primary: #F8FAFC;
      --secondary: #E2E8F0;
      --accent: #60A5FA;
      --accent-hover: #3B82F6;
      --success: #34D399;
      --danger: #F87171;
      --warning: #FBBF24;
      --text-primary: #F8FAFC;
      --text-secondary: #94A3B8;
      --bg-primary: #0F172A;
      --bg-secondary: #1E293B;
      --border: #334155;
      --shadow: rgba(0, 0, 0, 0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Animated grid background */
    body::before {
      content: '';
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background-image: 
        linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(139, 92, 246, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(139, 92, 246, 0.02) 1px, transparent 1px);
      background-size: 60px 60px, 60px 60px, 20px 20px, 20px 20px;
      pointer-events: none;
      opacity: 0.5;
      z-index: 0;
      animation: gridMove 40s linear infinite;
    }
    
    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(60px, 60px); }
    }
    
    /* Subtle radial gradients for depth */
    body::after {
      content: '';
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.03) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
      animation: pulse 10s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 0.7; }
    }
    
    /* Ensure content appears above background */
    .navbar,
    .container,
    .main-content {
      position: relative;
      z-index: 1;
    }
    
    /* Navigation */
    .navbar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 1px 3px var(--shadow);
    }
    
    /* Theme toggle */
    .theme-toggle {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .theme-toggle:hover {
      transform: scale(1.05);
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    /* Card styling */
    .card {
      transition: all 0.3s ease;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px var(--shadow);
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px var(--shadow);
    }
    
    /* Stats cards */
    .stat-card-1 {
      background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
    }
    
    .stat-card-2 {
      background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
    }
    
    .stat-card-3 {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    }
    
    .stat-card-4 {
      background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    }
    
    /* Search bar */
    .search-bar {
      background: var(--bg-primary);
      border: 2px solid var(--border);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .search-bar::placeholder {
      color: var(--text-secondary);
    }
    
    .search-bar:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Buttons */
    .btn-primary {
      background: var(--accent);
      color: white;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
    }
    
    .btn-secondary {
      background: var(--bg-primary);
      color: var(--text-primary);
      border: 2px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    /* Password item */
    .password-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      animation: slideIn 0.4s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .password-item:hover {
      background: var(--bg-primary);
      transform: translateX(4px);
      border-color: var(--accent);
    }
    
    /* Modal */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
    }
    
    .modal {
      background: var(--bg-secondary);
      animation: modalSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border);
    }
    
    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Input styling */
    .modern-input {
      background: var(--bg-primary);
      border: 2px solid var(--border);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .modern-input::placeholder {
      color: var(--text-secondary);
    }
    
    .modern-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Text colors */
    .text-primary {
      color: var(--text-primary);
    }
    
    .text-secondary {
      color: var(--text-secondary);
    }
    
    /* Quick action cards */
    .quick-action {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .quick-action:hover {
      background: var(--bg-secondary);
      transform: translateX(4px);
      border-color: var(--accent);
    }
    
    /* Tooltips */
    .tooltip {
      position: relative;
    }
    
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--secondary);
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      white-space: nowrap;
      margin-bottom: 8px;
      z-index: 100;
      box-shadow: 0 4px 12px var(--shadow);
    }
    
    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-hover);
    }
    
    /* Empty state */
    .empty-state {
      color: var(--text-secondary);
    }
    
    /* Icon colors */
    .icon-wrapper {
      color: var(--text-secondary);
      transition: all 0.3s ease;
    }
    
    .icon-wrapper:hover {
      color: var(--accent);
      transform: scale(1.1);
    }
    
    /* Range input */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      border-radius: 4px;
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease;
    }
    
    input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    /* Checkbox */
    input[type="checkbox"] {
      accent-color: var(--accent);
    }
    
    /* Badge */
    .badge {
      background: var(--accent);
      color: white;
    }
    
    /* Info box */
    .info-box {
      background: var(--bg-primary);
      border: 1px solid var(--border);
    }
    
    [data-theme="dark"] .info-box {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.2);
    }
    
    /* Toast Notification System */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .toast {
      background: white;
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      max-width: 400px;
      animation: slideInRight 0.3s ease-out;
      border-left: 4px solid;
    }
    
    [data-theme="dark"] .toast {
      background: var(--bg-secondary);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }
    
    .toast.success {
      border-left-color: #10B981;
    }
    
    .toast.error {
      border-left-color: #EF4444;
    }
    
    .toast.warning {
      border-left-color: #F59E0B;
    }
    
    .toast.info {
      border-left-color: #3B82F6;
    }
    
    .toast-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .toast.success .toast-icon {
      background: rgba(16, 185, 129, 0.1);
      color: #10B981;
    }
    
    .toast.error .toast-icon {
      background: rgba(239, 68, 68, 0.1);
      color: #EF4444;
    }
    
    .toast.warning .toast-icon {
      background: rgba(245, 158, 11, 0.1);
      color: #F59E0B;
    }
    
    .toast.info .toast-icon {
      background: rgba(59, 130, 246, 0.1);
      color: #3B82F6;
    }
    
    .toast-content {
      flex: 1;
    }
    
    .toast-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      margin-bottom: 2px;
    }
    
    .toast-message {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.4;
    }
    
    .toast-close {
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .toast-close:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }
    
    .toast.removing {
      animation: slideOutRight 0.3s ease-in forwards;
    }
    
    /* Success Modal with Encrypted Password Display */
    .success-modal-backdrop {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
    }
    
    .success-modal {
      background: var(--bg-secondary);
      animation: successModalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    @keyframes successModalSlideUp {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .encrypted-password-box {
      background: var(--bg-primary);
      border: 2px dashed var(--border);
      border-radius: 12px;
      padding: 16px;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      max-height: 200px;
      overflow-y: auto;
      position: relative;
    }
    
    .encrypted-password-box::-webkit-scrollbar {
      width: 6px;
    }
    
    .success-icon-wrapper {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      animation: successIconPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    
    @keyframes successIconPop {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    .checkmark {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: block;
      stroke-width: 3;
      stroke: white;
      stroke-miterlimit: 10;
      box-shadow: inset 0px 0px 0px white;
      animation: fillCheckmark 0.4s ease-in-out 0.4s forwards, scaleCheckmark 0.3s ease-in-out 0.9s both;
    }
    
    .checkmark-circle {
      stroke-dasharray: 166;
      stroke-dashoffset: 166;
      stroke-width: 3;
      stroke-miterlimit: 10;
      stroke: white;
      fill: none;
      animation: strokeCheckmark 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
    }
    
    .checkmark-check {
      transform-origin: 50% 50%;
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: strokeCheckmark 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
    }
    
    @keyframes strokeCheckmark {
      100% {
        stroke-dashoffset: 0;
      }
    }
    
    @keyframes scaleCheckmark {
      0%, 100% {
        transform: none;
      }
      50% {
        transform: scale3d(1.1, 1.1, 1);
      }
    }
    
    @keyframes fillCheckmark {
      100% {
        box-shadow: inset 0px 0px 0px 30px white;
      }
    }
  </style>
</head>
<body data-theme="light">
  
  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>
  
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="flex items-center gap-3">
          <div>
            <h1 class="text-xl" style="font-family: 'Inter', sans-serif; font-weight: 700; letter-spacing: -0.02em;">
              <span style="color: var(--text-primary);">Cipher</span><span style="font-weight: 300; color: var(--accent);"> Vault</span>
            </h1>
            <p class="text-xs text-secondary">Password Manager</p>
          </div>
        </div>
        
        <!-- Search Bar -->
        <div class="flex-1 max-w-2xl mx-8 hidden md:block">
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 text-secondary">
              <i class="fas fa-search"></i>
            </div>
            <input type="text" id="search-input" class="search-bar w-full rounded-xl pl-11 pr-4 py-2.5 text-sm outline-none" placeholder="Search passwords, notes, or websites...">
          </div>
        </div>
        
        <!-- User Menu -->
        <div class="flex items-center gap-3">
          <!-- Theme Toggle -->
          <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
            <i class="fas fa-moon" id="theme-icon"></i>
          </button>
          
          <!-- Settings Button -->
          <button class="theme-toggle" onclick="openSettingsModal()" aria-label="Settings">
            <i class="fas fa-cog"></i>
          </button>
          
          <div class="flex items-center gap-3 pl-3 border-l" style="border-color: var(--border);">
            <div class="text-right hidden sm:block">
              <p id="displayName" class="text-sm font-semibold text-primary">{{ display_name }}</p>
            </div>
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-lg cursor-pointer" onclick="openSettingsModal()" title="Open Settings">
              {{ display_name[0].upper() }}
            </div>
          </div>
          
          <a href="/logout" class="ml-2 p-2 text-secondary hover:text-red-500 transition-colors tooltip" data-tooltip="Logout">
            <i class="fas fa-sign-out-alt text-xl"></i>
          </a>
        </div>
      </div>
    </div>
  </nav>
  
  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <!-- Total Passwords -->
      <div class="card stat-card-1 text-white p-6 rounded-2xl">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm opacity-90 font-medium">Total Passwords</p>
            <h3 id="total-passwords" class="text-3xl font-bold mt-2">{{ total_passwords }}</h3>
            <p class="text-xs opacity-75 mt-1">Encrypted & Secure</p>
          </div>
          <div class="w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center">
            <i class="fas fa-key text-3xl"></i>
          </div>
        </div>
      </div>
      
      <!-- Weak Passwords -->
      <div class="card stat-card-2 text-white p-6 rounded-2xl">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm opacity-90 font-medium">Weak Passwords</p>
            <h3 id="weak-passwords" class="text-3xl font-bold mt-2">{{ weak_passwords }}</h3>
            <p class="text-xs opacity-75 mt-1">Need attention</p>
          </div>
          <div class="w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center">
            <i class="fas fa-exclamation-triangle text-3xl"></i>
          </div>
        </div>
      </div>
      
      <!-- Security Score -->
      <div id="securityScoreCard" class="card text-white p-6 rounded-2xl transition-all" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm opacity-90 font-medium">Security Score</p>
            <h3 id="security-score" class="text-3xl font-bold mt-2">{{ security_score }}%</h3>
            <p id="securityScoreText" class="text-xs opacity-75 mt-1">Excellent protection</p>
          </div>
          <div class="w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center">
            <i id="securityScoreIcon" class="fas fa-shield-alt text-3xl"></i>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
      
      <!-- Passwords List -->
      <div class="lg:col-span-2">
        <div class="card p-6 rounded-2xl">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-xl font-bold text-primary">Your Passwords</h2>
              <p class="text-sm text-secondary mt-1">Manage all your secure credentials</p>
            </div>
            <div class="flex gap-3">
              <button onclick="openImportModal()" class="btn-secondary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg flex items-center gap-2" style="background: var(--bg-primary); color: var(--text-primary); border: 2px solid var(--border);">
                <i class="fas fa-file-import"></i>
                <span>Import</span>
              </button>
              <button onclick="openDeleteAllModal()" class="btn-secondary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg flex items-center gap-2" style="background: var(--bg-primary); color: #EF4444; border: 2px solid rgba(239, 68, 68, 0.3);">
                <i class="fas fa-trash-alt"></i>
                <span>Delete All</span>
              </button>
              <button onclick="openAddPasswordModal()" class="btn-primary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg flex items-center gap-2">
                <i class="fas fa-plus"></i>
                <span>Add Password</span>
              </button>
            </div>
          </div>
          
          <!-- Password Items -->
          <div id="password-list" class="space-y-3 overflow-y-auto" style="max-height: 500px;">
            {% if passwords %}
              {% for password in passwords %}
              <div class="card p-4 rounded-xl flex items-center justify-between group hover:shadow-lg transition-shadow" data-password-id="{{ password.id }}" data-website="{{ password.website }}" data-username="{{ password.username }}">
                <div class="flex items-center gap-4 flex-1">
                  <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
                    <i class="fas fa-globe text-accent text-xl"></i>
                  </div>
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <h4 class="font-semibold text-primary">{{ password.website }}</h4>
                      {% if password.strength == 'weak' %}
                      <span class="px-2 py-1 text-xs rounded-lg font-medium" style="background: rgba(239, 68, 68, 0.1); color: #EF4444;">
                        <i class="fas fa-exclamation-triangle mr-1"></i>Weak
                      </span>
                      {% elif password.strength == 'medium' %}
                      <span class="px-2 py-1 text-xs rounded-lg font-medium" style="background: rgba(245, 158, 11, 0.1); color: #F59E0B;">
                        <i class="fas fa-shield-alt mr-1"></i>Medium
                      </span>
                      {% else %}
                      <span class="px-2 py-1 text-xs rounded-lg font-medium" style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
                        <i class="fas fa-shield-alt mr-1"></i>Strong
                      </span>
                      {% endif %}
                    </div>
                    <p class="text-sm text-secondary">{{ password.username }}</p>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button onclick="openViewPasswordModal({{ password.id }})" class="icon-wrapper p-2 transition-colors" title="View Password">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button onclick="openEditPasswordModal({{ password.id }})" class="icon-wrapper p-2 transition-colors text-blue-500" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button onclick="deletePassword({{ password.id }})" class="icon-wrapper p-2 transition-colors text-red-500" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              {% endfor %}
            {% else %}
            <!-- Empty State -->
            <div class="text-center py-16 empty-state flex flex-col items-center justify-center">
              <div class="w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
                <i class="fas fa-lock text-4xl" style="color: var(--accent);"></i>
              </div>
              <h3 class="text-xl font-semibold text-primary mb-2">No passwords yet</h3>
              <p class="text-sm text-secondary mb-6">Start securing your accounts by adding your first password</p>
              <button onclick="openAddPasswordModal()" class="btn-primary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg inline-flex items-center gap-2">
                <i class="fas fa-plus"></i>
                <span>Add Your First Password</span>
              </button>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Sidebar -->
      <div class="lg:col-span-1 space-y-6">
        
        <!-- Quick Actions -->
        <div class="card p-6 rounded-2xl">
          <h3 class="text-lg font-bold text-primary mb-4">Quick Actions</h3>
          <div class="space-y-3">
            <button onclick="openGeneratePasswordModal()" class="quick-action w-full text-left px-4 py-3 rounded-xl transition-colors flex items-center gap-3 group">
              <div class="w-10 h-10 rounded-lg bg-blue-500 bg-opacity-10 flex items-center justify-center text-blue-500 group-hover:scale-110 transition-transform">
                <i class="fas fa-random"></i>
              </div>
              <div>
                <p class="font-semibold text-primary text-sm">Generate Password</p>
                <p class="text-xs text-secondary">Create strong password</p>
              </div>
            </button>
            
            <button onclick="openImportModal()" class="quick-action w-full text-left px-4 py-3 rounded-xl transition-colors flex items-center gap-3 group">
              <div class="w-10 h-10 rounded-lg bg-green-500 bg-opacity-10 flex items-center justify-center text-green-500 group-hover:scale-110 transition-transform">
                <i class="fas fa-file-import"></i>
              </div>
              <div>
                <p class="font-semibold text-primary text-sm">Import Passwords</p>
                <p class="text-xs text-secondary">From other services</p>
              </div>
            </button>
            
            <button class="quick-action w-full text-left px-4 py-3 rounded-xl transition-colors flex items-center gap-3 group">
              <div class="w-10 h-10 rounded-lg bg-purple-500 bg-opacity-10 flex items-center justify-center text-purple-500 group-hover:scale-110 transition-transform">
                <i class="fas fa-file-export"></i>
              </div>
              <div>
                <p class="font-semibold text-primary text-sm">Export Data</p>
                <p class="text-xs text-secondary">Backup your vault</p>
              </div>
            </button>
          </div>
        </div>
        
        <!-- Developer Details -->
        <div class="card p-6 rounded-2xl">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
              <i class="fas fa-code text-accent text-lg"></i>
            </div>
            <h3 class="text-lg font-bold text-primary">Developer</h3>
          </div>
          <p class="text-sm text-secondary leading-relaxed mb-5">
            Crafted with <span style="color: #E93C6A;">❤️</span> by <span class="font-semibold text-primary">Piyush Jha</span>
          </p>
          <div class="grid grid-cols-2 gap-3">
            <a href="https://github.com/piyush-jha-16" target="_blank" class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all hover:scale-105" style="background: rgba(59, 130, 246, 0.1); color: var(--accent); border: 1px solid rgba(59, 130, 246, 0.3);" title="GitHub">
              <i class="fab fa-github text-xl"></i>
              <span class="text-sm">GitHub</span>
            </a>
            <a href="https://instagram.com/_piyushjha16" target="_blank" class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all hover:scale-105" style="background: rgba(233, 60, 106, 0.1); color: #E93C6A; border: 1px solid rgba(233, 60, 106, 0.3);" title="Instagram">
              <i class="fab fa-instagram text-xl"></i>
              <span class="text-sm">Instagram</span>
            </a>
            <a href="https://x.com/rzxpiyush16" target="_blank" class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all hover:scale-105" style="background: rgba(29, 161, 242, 0.1); color: #1DA1F2; border: 1px solid rgba(29, 161, 242, 0.3);" title="Twitter">
              <i class="fab fa-twitter text-xl"></i>
              <span class="text-sm">Twitter</span>
            </a>
            <a href="https://piyush-jha-16.github.io/" target="_blank" class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-medium transition-all hover:scale-105" style="background: rgba(16, 185, 129, 0.1); color: #10B981; border: 1px solid rgba(16, 185, 129, 0.3);" title="Portfolio">
              <i class="fas fa-globe text-xl"></i>
              <span class="text-sm">Portfolio</span>
            </a>
          </div>
        </div>
        
      </div>
      
    </div>
    
    <!-- Footer -->
    <footer class="mt-12 py-6 border-t" style="border-color: var(--border);">
      <div class="max-w-7xl mx-auto px-6">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
          <div class="text-center md:text-left">
            <p class="text-sm" style="color: var(--text-secondary);">
              © 2025 <span class="font-semibold" style="color: var(--text-primary);">Cipher Vault</span>. All rights reserved.
            </p>
          </div>
          <div class="flex items-center gap-6">
            <a href="#" class="text-sm transition-colors hover:text-accent" style="color: var(--text-secondary);">Privacy Policy</a>
            <a href="#" class="text-sm transition-colors hover:text-accent" style="color: var(--text-secondary);">Terms of Service</a>
            <a href="#" class="text-sm transition-colors hover:text-accent" style="color: var(--text-secondary);">Support</a>
          </div>
        </div>
      </div>
    </footer>
  </div>
  
  <!-- Import Passwords Modal -->
  <div id="importModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-primary">Import Passwords</h3>
        <button onclick="closeImportModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-4">
        <!-- Info Box -->
        <div class="p-4 rounded-xl" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2);">
          <div class="flex items-start gap-3">
            <i class="fas fa-info-circle text-blue-500 mt-0.5"></i>
            <div class="text-sm" style="color: var(--text-primary);">
              <p class="font-semibold mb-2">How to export from Google Password Manager:</p>
              <ol class="space-y-1 text-xs" style="color: var(--text-secondary);">
                <li>1. Go to <a href="https://passwords.google.com" target="_blank" class="text-blue-500 hover:underline">passwords.google.com</a></li>
                <li>2. Click Settings (gear icon)</li>
                <li>3. Click "Export passwords"</li>
                <li>4. Download the CSV file</li>
                <li>5. Upload it here</li>
              </ol>
            </div>
          </div>
        </div>
        
        <!-- File Upload -->
        <form id="importForm" enctype="multipart/form-data" class="space-y-4">
          <div>
            <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">CSV File</label>
            <div class="relative">
              <input type="file" id="importFile" accept=".csv" class="modern-input w-full rounded-xl px-4 py-3 text-sm outline-none" required>
            </div>
          </div>
          
          <div>
            <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Your Account Password</label>
            <div class="relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                <i class="fas fa-lock"></i>
              </div>
              <input type="password" id="importAccountPassword" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Enter your account password" required>
            </div>
            <p class="text-xs mt-2" style="color: var(--text-secondary);">Required to encrypt imported passwords</p>
          </div>
          
          <div id="importProgress" class="hidden">
            <div class="flex items-center gap-3 p-3 rounded-xl" style="background: rgba(59, 130, 246, 0.1);">
              <div class="animate-spin">
                <i class="fas fa-spinner text-blue-500"></i>
              </div>
              <span class="text-sm font-medium" style="color: var(--text-primary);">Importing passwords...</span>
            </div>
          </div>
          
          <div class="flex gap-3 pt-4">
            <button type="button" onclick="closeImportModal()" class="flex-1 px-6 py-3 rounded-xl font-semibold text-sm transition-all" style="background: var(--bg-primary); color: var(--text-primary); border: 2px solid var(--border);">
              Cancel
            </button>
            <button type="submit" class="btn-primary flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
              Import
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Confirm Password Modal (for delete operations) -->
  <div id="confirmPasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-primary">Confirm Your Identity</h3>
        <button onclick="closeConfirmPasswordModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <p class="text-sm text-secondary mb-6">Please enter your account password to confirm this action.</p>
      
      <form id="confirmPasswordForm" class="space-y-4">
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Account Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="confirmAccountPassword" class="modern-input w-full rounded-xl pl-11 pr-12 py-3 text-sm outline-none" placeholder="Enter your password" required>
            <button type="button" onclick="toggleConfirmPassword()" class="absolute right-4 top-1/2 -translate-y-1/2 icon-wrapper transition-colors">
              <i id="confirmPasswordToggleIcon" class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <div class="flex gap-3 pt-2">
          <button type="button" onclick="closeConfirmPasswordModal()" class="btn-secondary flex-1 px-6 py-3 rounded-xl font-semibold text-sm">
            Cancel
          </button>
          <button type="submit" class="btn-primary flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
            Confirm
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Delete All Passwords Modal -->
  <div id="deleteAllModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold" style="color: #EF4444;">Delete All Passwords</h3>
        <button onclick="closeDeleteAllModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="mb-6 p-4 rounded-xl" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
        <div class="flex items-start gap-3">
          <i class="fas fa-exclamation-triangle text-2xl" style="color: #EF4444;"></i>
          <div>
            <p class="font-semibold mb-1" style="color: #EF4444;">Warning: This action cannot be undone!</p>
            <p class="text-sm text-secondary">All {{ total_passwords }} passwords in your vault will be permanently deleted.</p>
          </div>
        </div>
      </div>
      
      <form id="deleteAllForm" class="space-y-4">
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Account Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="deleteAllPassword" class="modern-input w-full rounded-xl pl-11 pr-12 py-3 text-sm outline-none" placeholder="Enter your password to confirm" required>
            <button type="button" onclick="toggleDeleteAllPassword()" class="absolute right-4 top-1/2 -translate-y-1/2 icon-wrapper transition-colors">
              <i id="deleteAllPasswordToggleIcon" class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <div class="flex gap-3 pt-2">
          <button type="button" onclick="closeDeleteAllModal()" class="btn-secondary flex-1 px-6 py-3 rounded-xl font-semibold text-sm">
            Cancel
          </button>
          <button type="submit" class="flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg text-white" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
            Delete All
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Add Password Modal -->
  <div id="addPasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-primary">Add New Password</h3>
        <button onclick="closeAddPasswordModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="addPasswordForm" class="space-y-4">
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Website/Service</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-globe"></i>
            </div>
            <input type="text" id="website" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="e.g., facebook.com" required>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Username/Email</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-user"></i>
            </div>
            <input type="text" id="username" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Your username or email" required>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="password" class="modern-input w-full rounded-xl pl-11 pr-20 py-3 text-sm outline-none" placeholder="Enter password" required>
            <div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-2">
              <button type="button" onclick="togglePasswordVisibility()" class="icon-wrapper transition-colors">
                <i class="fas fa-eye"></i>
              </button>
              <button type="button" onclick="generatePassword()" class="icon-wrapper transition-colors">
                <i class="fas fa-random"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Notes (Optional)</label>
          <textarea id="notes" rows="3" class="modern-input w-full rounded-xl px-4 py-3 text-sm outline-none" placeholder="Add any additional notes..."></textarea>
        </div>
        
        <div class="info-box p-4 rounded-xl">
          <div class="flex items-start gap-3">
            <i class="fas fa-shield-alt text-accent mt-1"></i>
            <div>
              <p class="text-xs font-semibold text-primary mb-1">Security Notice</p>
              <p class="text-xs text-secondary">Enter your account password to encrypt this password securely.</p>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Your Account Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-shield-alt"></i>
            </div>
            <input type="password" id="accountPassword" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Enter your account password" required>
          </div>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeAddPasswordModal()" class="btn-secondary flex-1 px-6 py-3 rounded-xl font-semibold text-sm transition-all">
            Cancel
          </button>
          <button type="submit" class="btn-primary flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
            <i class="fas fa-save mr-2"></i>
            Save Password
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Edit Password Modal -->
  <div id="editPasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-2xl shadow-2xl max-w-md w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-primary">Edit Password</h3>
        <button onclick="closeEditPasswordModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="editPasswordForm" class="space-y-4">
        <input type="hidden" id="editPasswordId">
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Website/Service</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-globe"></i>
            </div>
            <input type="text" id="editWebsite" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="e.g., facebook.com" required>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Username/Email</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-user"></i>
            </div>
            <input type="text" id="editUsername" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Your username or email" required>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-lock"></i>
            </div>
            <input type="password" id="editPassword" class="modern-input w-full rounded-xl pl-11 pr-20 py-3 text-sm outline-none" placeholder="Enter password" required>
            <div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-2">
              <button type="button" onclick="toggleEditPasswordVisibility()" class="icon-wrapper transition-colors">
                <i class="fas fa-eye"></i>
              </button>
              <button type="button" onclick="generateEditPassword()" class="icon-wrapper transition-colors">
                <i class="fas fa-random"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="info-box p-4 rounded-xl">
          <div class="flex items-start gap-3">
            <i class="fas fa-shield-alt text-accent mt-1"></i>
            <div>
              <p class="text-xs font-semibold text-primary mb-1">Security Notice</p>
              <p class="text-xs text-secondary">Enter your account password to update this encrypted password.</p>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Your Account Password</label>
          <div class="relative">
            <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
              <i class="fas fa-shield-alt"></i>
            </div>
            <input type="password" id="editAccountPassword" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Enter your account password" required>
          </div>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeEditPasswordModal()" class="flex-1 px-6 py-3 rounded-xl font-semibold text-sm transition-colors" style="background: var(--card); color: var(--text-secondary); border: 1px solid var(--border);">
            Cancel
          </button>
          <button type="submit" class="flex-1 btn-primary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
            Update Password
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Generate Password Modal -->
  <div id="generatePasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="modal rounded-3xl shadow-2xl max-w-lg w-full mx-4 p-8" style="background: var(--bg-secondary);">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);">
            <i class="fas fa-key text-white"></i>
          </div>
          <h3 class="text-2xl font-bold text-primary">Password Generator</h3>
        </div>
        <button onclick="closeGeneratePasswordModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-6">
        <!-- Generated Password Display -->
        <div class="relative">
          <div class="p-5 rounded-2xl border-2 transition-all" style="background: var(--bg-primary); border-color: var(--border);">
            <div class="flex items-center gap-3">
              <div class="flex-1 overflow-hidden">
                <label class="text-xs font-semibold text-secondary uppercase tracking-wide mb-2 block">Generated Password</label>
                <code id="generatedPassword" class="text-xl font-mono text-primary font-bold break-all block">Cy$9mK#nQ2pL</code>
              </div>
              <div class="flex flex-col gap-2">
                <button onclick="regeneratePassword()" class="w-12 h-12 rounded-xl text-white hover:shadow-lg transition-all flex items-center justify-center" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);" title="Generate New">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button onclick="copyGeneratedPassword()" class="w-12 h-12 rounded-xl transition-all flex items-center justify-center hover:shadow-lg" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white;" title="Copy">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Length Slider -->
        <div class="p-4 rounded-xl" style="background: var(--bg-primary);">
          <div class="flex items-center justify-between mb-3">
            <label class="text-sm font-semibold text-primary">Password Length</label>
            <div class="flex items-center gap-2">
              <span id="lengthValue" class="text-2xl font-bold" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">16</span>
              <span class="text-sm text-secondary">characters</span>
            </div>
          </div>
          <input type="range" id="passwordLength" min="8" max="32" value="16" class="w-full h-2 rounded-full appearance-none cursor-pointer" style="background: linear-gradient(to right, #6366F1 0%, #6366F1 50%, var(--border) 50%, var(--border) 100%);">
        </div>
        
        <!-- Character Options -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-primary block mb-3">Include Characters</label>
          
          <label class="flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all hover:shadow-md" style="background: var(--bg-primary); border: 2px solid var(--border);">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(99, 102, 241, 0.1);">
                <span class="text-lg font-bold" style="color: #6366F1;">Aa</span>
              </div>
              <div>
                <span class="text-sm font-semibold text-primary block">Uppercase & Lowercase</span>
                <span class="text-xs text-secondary">A-Z, a-z</span>
              </div>
            </div>
            <input type="checkbox" id="includeLetters" checked class="w-5 h-5 rounded" style="accent-color: #6366F1;">
          </label>
          
          <label class="flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all hover:shadow-md" style="background: var(--bg-primary); border: 2px solid var(--border);">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
                <span class="text-lg font-bold" style="color: #3B82F6;">123</span>
              </div>
              <div>
                <span class="text-sm font-semibold text-primary block">Numbers</span>
                <span class="text-xs text-secondary">0-9</span>
              </div>
            </div>
            <input type="checkbox" id="includeNumbers" checked class="w-5 h-5 rounded" style="accent-color: #3B82F6;">
          </label>
          
          <label class="flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all hover:shadow-md" style="background: var(--bg-primary); border: 2px solid var(--border);">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(139, 92, 246, 0.1);">
                <span class="text-lg font-bold" style="color: #8B5CF6;">@#$</span>
              </div>
              <div>
                <span class="text-sm font-semibold text-primary block">Special Characters</span>
                <span class="text-xs text-secondary">!@#$%^&*</span>
              </div>
            </div>
            <input type="checkbox" id="includeSymbols" checked class="w-5 h-5 rounded" style="accent-color: #8B5CF6;">
          </label>
        </div>
        
        <!-- Info Box -->
        <div class="info-box p-4 rounded-xl">
          <div class="flex items-start gap-3">
            <i class="fas fa-lightbulb text-lg mt-0.5" style="color: #F59E0B;"></i>
            <div>
              <p class="text-xs font-semibold text-primary mb-1">Pro Tip</p>
              <p class="text-xs text-secondary">For maximum security, use at least 16 characters with all character types enabled.</p>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex gap-3">
          <button onclick="closeGeneratePasswordModal()" class="flex-1 px-6 py-3 rounded-xl font-semibold text-sm transition-all" style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border);">
            Cancel
          </button>
          <button onclick="useGeneratedPassword()" class="flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg text-white transition-all hover:shadow-xl" style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);">
            <i class="fas fa-check mr-2"></i>
            Use Password
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- View Password Modal -->
  <div id="viewPasswordModal" class="hidden fixed inset-0 z-50 flex items-center justify-center success-modal-backdrop">
    <div class="success-modal rounded-2xl shadow-2xl max-w-2xl w-full mx-4 p-8">
      
      <div id="viewPasswordContent">
        <!-- Authentication Form -->
        <div id="authSection">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-primary">🔓 View Password</h3>
            <button onclick="closeViewPasswordModal()" class="icon-wrapper transition-colors">
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          
          <div class="info-box p-4 rounded-xl mb-6">
            <div class="flex items-start gap-3">
              <i class="fas fa-shield-alt text-accent text-xl mt-1"></i>
              <div>
                <p class="text-sm font-semibold text-primary mb-1">Security Verification Required</p>
                <p class="text-xs text-secondary">For your security, please enter your account password to decrypt and view this password.</p>
              </div>
            </div>
          </div>
          
          <input type="hidden" id="viewPasswordId">
          <input type="hidden" id="viewPasswordWebsite">
          <input type="hidden" id="viewPasswordUsername">
          
          <div class="mb-6">
            <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Your Account Password</label>
            <div class="relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                <i class="fas fa-shield-alt"></i>
              </div>
              <input type="password" id="viewAccountPassword" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Enter your account password" onkeypress="if(event.key==='Enter') authenticateAndViewPassword()">
            </div>
          </div>
          
          <div class="flex gap-3">
            <button onclick="closeViewPasswordModal()" class="btn-secondary flex-1 px-6 py-3 rounded-xl font-semibold text-sm transition-all">
              Cancel
            </button>
            <button onclick="authenticateAndViewPassword()" class="btn-primary flex-1 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
              <i class="fas fa-unlock mr-2"></i>
              Decrypt & View
            </button>
          </div>
        </div>
        
        <!-- Password Display (shown after authentication) -->
        <div id="passwordDisplaySection" class="hidden">
          <div class="text-center mb-6">
            <div class="success-icon-wrapper">
              <i class="fas fa-unlock-alt text-white text-4xl"></i>
            </div>
            <h3 class="text-3xl font-bold text-primary mb-2">Password Decrypted! 🔓</h3>
            <p class="text-sm text-secondary">Your password has been successfully decrypted.</p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <!-- Website/Service -->
            <div class="card p-4 rounded-xl">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
                  <i class="fas fa-globe text-accent"></i>
                </div>
                <div>
                  <p class="text-xs font-semibold uppercase tracking-wide" style="color: var(--text-secondary);">Website/Service</p>
                  <p id="displayWebsite" class="text-sm font-bold text-primary"></p>
                </div>
              </div>
            </div>
            
            <!-- Username -->
            <div class="card p-4 rounded-xl">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(16, 185, 129, 0.1);">
                  <i class="fas fa-user text-success"></i>
                </div>
                <div>
                  <p class="text-xs font-semibold uppercase tracking-wide" style="color: var(--text-secondary);">Username</p>
                  <p id="displayUsername" class="text-sm font-bold text-primary break-all"></p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Decrypted Password Display -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <i class="fas fa-key text-accent"></i>
                <h4 class="text-sm font-bold text-primary">Decrypted Password</h4>
              </div>
              <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
                <i class="fas fa-unlock mr-1"></i>Decrypted
              </span>
            </div>
            
            <div class="card p-5 rounded-xl" style="background: var(--bg-primary);">
              <div class="flex items-center justify-between gap-3">
                <code id="decryptedPassword" class="text-xl font-mono text-primary flex-1 break-all font-bold"></code>
                <button onclick="copyDecryptedPassword()" class="icon-wrapper p-3 transition-all hover:scale-110" title="Copy to Clipboard" style="background: var(--accent); color: white; border-radius: 10px;">
                  <i class="fas fa-copy text-lg"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Security Tip -->
          <div class="mb-6 p-4 rounded-xl" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3);">
            <div class="flex items-start gap-3">
              <i class="fas fa-lightbulb text-warning text-xl mt-0.5"></i>
              <div>
                <p class="text-xs font-semibold text-primary mb-2">💡 Security Tip</p>
                <p class="text-xs text-secondary leading-relaxed">
                  Make sure no one is watching your screen while viewing passwords. For maximum security, consider changing passwords regularly 
                  and never use the same password across multiple accounts. This password will be hidden when you close this window.
                </p>
              </div>
            </div>
          </div>
          
          <button onclick="closeViewPasswordModal()" class="w-full btn-primary px-6 py-4 rounded-xl font-semibold text-base shadow-lg">
            <i class="fas fa-check mr-2"></i>
            Done
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Settings Modal -->
  <div id="settingsModal" class="hidden fixed inset-0 z-50 flex items-center justify-center success-modal-backdrop">
    <div class="success-modal rounded-2xl shadow-2xl max-w-2xl w-full mx-4 p-8">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
            <i class="fas fa-cog text-accent text-2xl"></i>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-primary">Settings</h3>
            <p class="text-sm text-secondary">Manage your account preferences</p>
          </div>
        </div>
        <button onclick="closeSettingsModal()" class="icon-wrapper transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <!-- Settings Sections -->
      <div class="space-y-6">
        
        <!-- Profile Section -->
        <div class="card p-6 rounded-xl">
          <div class="flex items-center gap-3 mb-4">
            <i class="fas fa-user-circle text-accent text-xl"></i>
            <h4 class="text-lg font-bold text-primary">Profile Information</h4>
          </div>
          
          <!-- Display Name -->
          <div class="mb-4">
            <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Display Name</label>
            <div class="relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                <i class="fas fa-user"></i>
              </div>
              <input type="text" id="settingsDisplayName" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none" placeholder="Your display name" value="{{ display_name }}">
            </div>
            <p class="text-xs text-secondary mt-2">This name will be displayed throughout the application.</p>
          </div>
          
          <!-- Username (Read-only) -->
          <div class="mb-4">
            <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Username (Login ID)</label>
            <div class="relative">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                <i class="fas fa-at"></i>
              </div>
              <input type="text" class="modern-input w-full rounded-xl pl-11 pr-4 py-3 text-sm outline-none opacity-60 cursor-not-allowed" value="{{ username }}" readonly disabled>
            </div>
            <p class="text-xs text-secondary mt-2">
              <i class="fas fa-lock text-xs mr-1"></i>
              Username is your login ID and cannot be changed.
            </p>
          </div>
          
          <button onclick="updateDisplayName()" class="btn-primary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
            <i class="fas fa-save mr-2"></i>
            Save Display Name
          </button>
        </div>
        
        <!-- Security Section -->
        <div class="card p-6 rounded-xl">
          <div class="flex items-center gap-3 mb-4">
            <i class="fas fa-shield-alt text-accent text-xl"></i>
            <h4 class="text-lg font-bold text-primary">Security Settings</h4>
          </div>
          
          <form id="changePasswordForm" class="space-y-4">
            <!-- Current Password -->
            <div>
              <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Current Password</label>
              <div class="relative">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-lock"></i>
                </div>
                <input type="password" id="currentPassword" class="modern-input w-full rounded-xl pl-11 pr-12 py-3 text-sm outline-none" placeholder="Enter current password" required>
                <button type="button" onclick="togglePasswordVisibility('currentPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <!-- New Password -->
            <div>
              <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">New Password</label>
              <div class="relative">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-key"></i>
                </div>
                <input type="password" id="newPassword" class="modern-input w-full rounded-xl pl-11 pr-12 py-3 text-sm outline-none" placeholder="Enter new password" required>
                <button type="button" onclick="togglePasswordVisibility('newPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <!-- Confirm New Password -->
            <div>
              <label class="block text-xs font-semibold mb-2 uppercase tracking-wide" style="color: var(--text-secondary);">Confirm New Password</label>
              <div class="relative">
                <div class="absolute left-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-key"></i>
                </div>
                <input type="password" id="confirmPassword" class="modern-input w-full rounded-xl pl-11 pr-12 py-3 text-sm outline-none" placeholder="Confirm new password" required>
                <button type="button" onclick="togglePasswordVisibility('confirmPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 icon-wrapper">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <div class="info-box p-3 rounded-lg">
              <div class="flex items-start gap-2">
                <i class="fas fa-info-circle text-accent text-sm mt-0.5"></i>
                <p class="text-xs text-secondary leading-relaxed">
                  <strong>Important:</strong> Changing your password will require re-encrypting all stored passwords. 
                  You'll need to enter your current password to proceed.
                </p>
              </div>
            </div>
            
            <button type="submit" class="btn-primary px-6 py-3 rounded-xl font-semibold text-sm shadow-lg">
              <i class="fas fa-shield-alt mr-2"></i>
              Change Password
            </button>
          </form>
        </div>
        
        <!-- Danger Zone -->
        <div class="card p-6 rounded-xl" style="border: 2px solid rgba(239, 68, 68, 0.2); background: rgba(239, 68, 68, 0.05);">
          <div class="flex items-center gap-3 mb-4">
            <i class="fas fa-exclamation-triangle text-danger text-xl"></i>
            <h4 class="text-lg font-bold text-danger">Danger Zone</h4>
          </div>
          
          <p class="text-sm text-secondary mb-4">
            Once you logout, you'll need to sign in again to access your passwords.
          </p>
          
          <a href="/logout" class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-semibold text-sm shadow-lg transition-all" style="background: #EF4444; color: white;" onmouseover="this.style.background='#DC2626'" onmouseout="this.style.background='#EF4444'">
            <i class="fas fa-sign-out-alt"></i>
            Logout from Account
          </a>
        </div>
        
      </div>
    </div>
  </div>
  
  <!-- Success Modal - Password Saved -->
  <div id="successModal" class="hidden fixed inset-0 z-50 flex items-center justify-center success-modal-backdrop">
    <div class="success-modal rounded-2xl shadow-2xl max-w-2xl w-full mx-4 p-8">
      <div class="text-center mb-6">
        <div class="success-icon-wrapper">
          <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
          </svg>
        </div>
        <h3 class="text-3xl font-bold text-primary mb-2">Password Saved Successfully! 🎉</h3>
        <p class="text-sm text-secondary">Your password has been encrypted and stored securely.</p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <!-- Website/Service -->
        <div class="card p-4 rounded-xl">
          <div class="flex items-center gap-3 mb-2">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(59, 130, 246, 0.1);">
              <i class="fas fa-globe text-accent"></i>
            </div>
            <div>
              <p class="text-xs font-semibold uppercase tracking-wide" style="color: var(--text-secondary);">Website/Service</p>
              <p id="successWebsite" class="text-sm font-bold text-primary"></p>
            </div>
          </div>
        </div>
        
        <!-- Username -->
        <div class="card p-4 rounded-xl">
          <div class="flex items-center gap-3 mb-2">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: rgba(16, 185, 129, 0.1);">
              <i class="fas fa-user text-success"></i>
            </div>
            <div>
              <p class="text-xs font-semibold uppercase tracking-wide" style="color: var(--text-secondary);">Username</p>
              <p id="successUsername" class="text-sm font-bold text-primary break-all"></p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Encrypted Password Display -->
      <div class="mb-6">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <i class="fas fa-lock text-accent"></i>
            <h4 class="text-sm font-bold text-primary">Encrypted Password</h4>
          </div>
          <span class="px-3 py-1 rounded-full text-xs font-semibold" style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
            <i class="fas fa-shield-alt mr-1"></i>AES-256 Encrypted
          </span>
        </div>
        
        <div class="encrypted-password-box">
          <code id="successEncryptedPassword" class="text-xs text-secondary leading-relaxed"></code>
        </div>
        
        <div class="mt-3 info-box p-3 rounded-lg">
          <div class="flex items-start gap-2">
            <i class="fas fa-info-circle text-accent text-sm mt-0.5"></i>
            <div>
              <p class="text-xs font-semibold text-primary mb-1">Security Note</p>
              <p class="text-xs text-secondary leading-relaxed">
                This is the encrypted version of your password stored in our database. It cannot be decrypted without your account password. 
                Your original password is never stored in plain text.
              </p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Password Strength Indicator -->
      <div class="mb-6 card p-4 rounded-xl">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div id="successStrengthIcon" class="w-10 h-10 rounded-lg flex items-center justify-center">
              <i class="fas fa-shield-alt text-xl"></i>
            </div>
            <div>
              <p class="text-xs font-semibold uppercase tracking-wide" style="color: var(--text-secondary);">Password Strength</p>
              <p id="successStrength" class="text-sm font-bold"></p>
            </div>
          </div>
          <div id="successStrengthBadge" class="px-4 py-2 rounded-lg font-semibold text-sm"></div>
        </div>
      </div>
      
      <button onclick="closeSuccessModal()" class="w-full btn-primary px-6 py-4 rounded-xl font-semibold text-base shadow-lg">
        <i class="fas fa-check mr-2"></i>
        Got it! Close
      </button>
    </div>
  </div>
  
  <script>
    // Toast Notification System
    function showToast(title, message, type = 'info', duration = 4000) {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
      };
      
      toast.innerHTML = `
        <div class="toast-icon">
          <i class="fas ${icons[type]}"></i>
        </div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <div class="toast-close" onclick="removeToast(this)">
          <i class="fas fa-times"></i>
        </div>
      `;
      
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        removeToast(toast);
      }, duration);
    }
    
    function removeToast(element) {
      const toast = element.classList?.contains('toast') ? element : element.closest('.toast');
      if (toast) {
        toast.classList.add('removing');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    }
    
    // Success Modal Functions
    function openSuccessModal(data) {
      document.getElementById('successWebsite').textContent = data.website;
      document.getElementById('successUsername').textContent = data.username;
      document.getElementById('successEncryptedPassword').textContent = data.encryptedPassword;
      
      // Set strength indicator
      const strengthIcon = document.getElementById('successStrengthIcon');
      const strengthText = document.getElementById('successStrength');
      const strengthBadge = document.getElementById('successStrengthBadge');
      
      if (data.strength === 'weak') {
        strengthIcon.style.background = 'rgba(239, 68, 68, 0.1)';
        strengthIcon.querySelector('i').style.color = '#EF4444';
        strengthText.textContent = 'Weak Password';
        strengthText.style.color = '#EF4444';
        strengthBadge.textContent = '⚠️ Weak';
        strengthBadge.style.background = 'rgba(239, 68, 68, 0.1)';
        strengthBadge.style.color = '#EF4444';
      } else if (data.strength === 'medium') {
        strengthIcon.style.background = 'rgba(245, 158, 11, 0.1)';
        strengthIcon.querySelector('i').style.color = '#F59E0B';
        strengthText.textContent = 'Medium Strength';
        strengthText.style.color = '#F59E0B';
        strengthBadge.textContent = '⚡ Medium';
        strengthBadge.style.background = 'rgba(245, 158, 11, 0.1)';
        strengthBadge.style.color = '#F59E0B';
      } else {
        strengthIcon.style.background = 'rgba(16, 185, 129, 0.1)';
        strengthIcon.querySelector('i').style.color = '#10B981';
        strengthText.textContent = 'Strong Password';
        strengthText.style.color = '#10B981';
        strengthBadge.textContent = '✓ Strong';
        strengthBadge.style.background = 'rgba(16, 185, 129, 0.1)';
        strengthBadge.style.color = '#10B981';
      }
      
      document.getElementById('successModal').classList.remove('hidden');
    }
    
    function closeSuccessModal() {
      document.getElementById('successModal').classList.add('hidden');
      // Reload page to show new password in list
      window.location.reload();
    }
    
    // Modal functions
    function openAddPasswordModal() {
      document.getElementById('addPasswordModal').classList.remove('hidden');
      document.getElementById('addPasswordForm').reset();
    }
    
    function closeAddPasswordModal() {
      document.getElementById('addPasswordModal').classList.add('hidden');
    }
    
    // Import Modal functions
    function openImportModal() {
      document.getElementById('importModal').classList.remove('hidden');
      document.getElementById('importForm').reset();
      document.getElementById('importProgress').classList.add('hidden');
    }
    
    function closeImportModal() {
      document.getElementById('importModal').classList.add('hidden');
    }
    
    // Confirm Password Modal functions
    function openConfirmPasswordModal() {
      document.getElementById('confirmPasswordModal').classList.remove('hidden');
      document.getElementById('confirmPasswordForm').reset();
    }
    
    function closeConfirmPasswordModal() {
      document.getElementById('confirmPasswordModal').classList.add('hidden');
      document.getElementById('confirmPasswordForm').reset();
      pendingDeletePasswordId = null;
    }
    
    function toggleConfirmPassword() {
      const input = document.getElementById('confirmAccountPassword');
      const icon = document.getElementById('confirmPasswordToggleIcon');
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    // Delete All Modal functions
    function openDeleteAllModal() {
      const totalPasswords = parseInt(document.getElementById('total-passwords').textContent);
      if (totalPasswords === 0) {
        showToast('No Passwords', 'There are no passwords to delete.', 'error');
        return;
      }
      document.getElementById('deleteAllModal').classList.remove('hidden');
      document.getElementById('deleteAllForm').reset();
    }
    
    function closeDeleteAllModal() {
      document.getElementById('deleteAllModal').classList.add('hidden');
      document.getElementById('deleteAllForm').reset();
    }
    
    function toggleDeleteAllPassword() {
      const input = document.getElementById('deleteAllPassword');
      const icon = document.getElementById('deleteAllPasswordToggleIcon');
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    async function deleteAllPasswords(event) {
      event.preventDefault();
      
      const accountPassword = document.getElementById('deleteAllPassword').value.trim();
      
      if (!accountPassword) {
        showToast('Password Required', 'Please enter your account password.', 'error');
        return;
      }
      
      try {
        const response = await fetch('/delete_all_passwords', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ accountPassword })
        });
        
        const data = await response.json();
        
        if (data.success) {
          closeDeleteAllModal();
          showToast('All Passwords Deleted', `Successfully deleted ${data.deleted_count} passwords.`, 'success');
          
          // Reload page after a short delay
          setTimeout(() => window.location.reload(), 1500);
        } else {
          showToast('Delete Failed', data.error, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Delete Failed', 'Failed to delete passwords. Please try again.', 'error');
      }
    }
    
    // Edit Password Modal functions
    function openEditPasswordModal(passwordId) {
      const passwordElement = document.querySelector(`[data-password-id="${passwordId}"]`);
      const website = passwordElement.getAttribute('data-website');
      const username = passwordElement.getAttribute('data-username');
      
      document.getElementById('editPasswordId').value = passwordId;
      document.getElementById('editWebsite').value = website;
      document.getElementById('editUsername').value = username;
      document.getElementById('editPassword').value = '';
      
      document.getElementById('editPasswordModal').classList.remove('hidden');
    }
    
    function closeEditPasswordModal() {
      document.getElementById('editPasswordModal').classList.add('hidden');
      document.getElementById('editPasswordForm').reset();
    }
    
    // Edit password function
    async function editPassword(event) {
      event.preventDefault();
      
      const passwordId = document.getElementById('editPasswordId').value;
      const website = document.getElementById('editWebsite').value.trim();
      const username = document.getElementById('editUsername').value.trim();
      const password = document.getElementById('editPassword').value.trim();
      const accountPassword = document.getElementById('editAccountPassword').value.trim();
      
      if (!website || !username || !password || !accountPassword) {
        showToast('Missing Fields', 'All fields are required to update the password.', 'error');
        return;
      }
      
      try {
        const response = await fetch(`/edit_password/${passwordId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ website, username, password, accountPassword })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update stats
          updateStats(data.stats);
          
          // Close edit modal
          closeEditPasswordModal();
          
          // Show success toast based on strength
          if (data.strength === 'weak') {
            showToast('Password Updated', '⚠️ Your password was updated but it\'s weak. Consider using a stronger password.', 'warning', 5000);
          } else if (data.strength === 'medium') {
            showToast('Password Updated', '✓ Your password was updated with medium strength.', 'success');
          } else {
            showToast('Password Updated', '✓ Your password was updated with strong security!', 'success');
          }
          
          // Reload page after a short delay
          setTimeout(() => window.location.reload(), 2000);
        } else {
          showToast('Update Failed', data.error, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Update Failed', 'Failed to update password. Please try again.', 'error');
      }
    }
    
    // Toggle edit password visibility
    function toggleEditPasswordVisibility() {
      const input = document.getElementById('editPassword');
      const icon = event.target;
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    // Generate password for edit modal
    function generateEditPassword() {
      const length = 16;
      const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
      let password = "";
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      document.getElementById('editPassword').value = password;
    }
    
    // Add password function
    async function addPassword(event) {
      event.preventDefault();
      
      const website = document.getElementById('website').value.trim();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const accountPassword = document.getElementById('accountPassword').value.trim();
      
      if (!website || !username || !password || !accountPassword) {
        showToast('Missing Fields', 'All fields are required to save the password.', 'error');
        return;
      }
      
      try {
        const response = await fetch('/add_password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ website, username, password, accountPassword })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update stats
          updateStats(data.stats);
          
          // Close add modal
          closeAddPasswordModal();
          
          // Show success modal with encrypted password
          openSuccessModal({
            website: website,
            username: username,
            encryptedPassword: data.encryptedPassword,
            strength: data.strength
          });
        } else {
          showToast('Save Failed', data.error, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Save Failed', 'Failed to save password. Please try again.', 'error');
      }
    }
    
    // Delete password function with authentication
    let pendingDeletePasswordId = null;
    
    function deletePassword(passwordId) {
      pendingDeletePasswordId = passwordId;
      openConfirmPasswordModal();
    }
    
    async function confirmDeletePassword() {
      const accountPassword = document.getElementById('confirmAccountPassword').value.trim();
      
      if (!accountPassword) {
        showToast('Password Required', 'Please enter your account password.', 'error');
        return;
      }
      
      if (!pendingDeletePasswordId) {
        showToast('Error', 'No password selected for deletion.', 'error');
        return;
      }
      
      try {
        const response = await fetch(`/delete_password/${pendingDeletePasswordId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ accountPassword })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Close confirmation modal
          closeConfirmPasswordModal();
          
          // Update stats
          updateStats(data.stats);
          
          // Show success toast
          showToast('Password Deleted', 'The password has been permanently removed.', 'success');
          
          // Remove the password element with animation
          const passwordElement = document.querySelector(`[data-password-id="${pendingDeletePasswordId}"]`);
          if (passwordElement) {
            passwordElement.style.animation = 'slideOutRight 0.3s ease-in forwards';
            setTimeout(() => passwordElement.remove(), 300);
          }
          
          pendingDeletePasswordId = null;
          
          // Check if list is now empty
          setTimeout(() => {
            const passwordList = document.getElementById('password-list');
            if (passwordList.children.length === 0) {
              window.location.reload();
            }
          }, 400);
        } else {
          showToast('Delete Failed', data.error, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('Delete Failed', 'Failed to delete password. Please try again.', 'error');
      }
    }
    
    // Update stats function
    function updateStats(stats) {
      document.getElementById('total-passwords').textContent = stats.total_passwords;
      document.getElementById('weak-passwords').textContent = stats.weak_passwords;
      document.getElementById('security-score').textContent = stats.security_score + '%';
      updateSecurityScoreColor(stats.security_score);
    }
    
    // View Password Modal functions
    function openViewPasswordModal(passwordId) {
      const passwordElement = document.querySelector(`[data-password-id="${passwordId}"]`);
      const website = passwordElement.getAttribute('data-website');
      const username = passwordElement.getAttribute('data-username');
      
      document.getElementById('viewPasswordId').value = passwordId;
      document.getElementById('viewPasswordWebsite').value = website;
      document.getElementById('viewPasswordUsername').value = username;
      document.getElementById('viewAccountPassword').value = '';
      document.getElementById('authSection').classList.remove('hidden');
      document.getElementById('passwordDisplaySection').classList.add('hidden');
      document.getElementById('viewPasswordModal').classList.remove('hidden');
    }
    
    function closeViewPasswordModal() {
      document.getElementById('viewPasswordModal').classList.add('hidden');
      document.getElementById('viewAccountPassword').value = '';
      document.getElementById('decryptedPassword').textContent = '';
      document.getElementById('displayWebsite').textContent = '';
      document.getElementById('displayUsername').textContent = '';
    }
    
    // Authenticate and view password
    async function authenticateAndViewPassword() {
      const passwordId = document.getElementById('viewPasswordId').value;
      const website = document.getElementById('viewPasswordWebsite').value;
      const username = document.getElementById('viewPasswordUsername').value;
      const accountPassword = document.getElementById('viewAccountPassword').value.trim();
      
      if (!accountPassword) {
        showToast('Password Required', 'Please enter your account password to view this password.', 'warning');
        return;
      }
      
      try {
        const response = await fetch(`/view_password/${passwordId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ accountPassword })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Populate the display fields
          document.getElementById('displayWebsite').textContent = website;
          document.getElementById('displayUsername').textContent = username;
          document.getElementById('decryptedPassword').textContent = data.password;
          
          // Switch views
          document.getElementById('authSection').classList.add('hidden');
          document.getElementById('passwordDisplaySection').classList.remove('hidden');
          
          showToast('Password Decrypted', 'Your password has been decrypted successfully.', 'success', 3000);
        } else {
          showToast('Authentication Failed', data.error, 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('View Failed', 'Failed to decrypt password. Please try again.', 'error');
      }
    }
    
    // Copy decrypted password
    function copyDecryptedPassword() {
      const password = document.getElementById('decryptedPassword').textContent;
      navigator.clipboard.writeText(password).then(() => {
        showToast('Copied!', 'Password copied to clipboard.', 'success', 2000);
        const btn = event.target.closest('button');
        const icon = btn.querySelector('i');
        icon.classList.remove('fa-copy');
        icon.classList.add('fa-check');
        setTimeout(() => {
          icon.classList.remove('fa-check');
          icon.classList.add('fa-copy');
        }, 2000);
      }).catch(() => {
        showToast('Copy Failed', 'Failed to copy password to clipboard.', 'error');
      });
    }
    
    // Copy password (removed - users must view password first)
    function copyPassword(encryptedPassword) {
      showToast('Security Notice', 'Please use the "View Password" button to decrypt and copy your password securely.', 'info', 4000);
    }
    
    // Attach form submit handler
    document.addEventListener('DOMContentLoaded', function() {
      const addForm = document.getElementById('addPasswordForm');
      if (addForm) {
        addForm.addEventListener('submit', addPassword);
      }
      
      const editForm = document.getElementById('editPasswordForm');
      if (editForm) {
        editForm.addEventListener('submit', editPassword);
      }
      
      const confirmPasswordForm = document.getElementById('confirmPasswordForm');
      if (confirmPasswordForm) {
        confirmPasswordForm.addEventListener('submit', function(e) {
          e.preventDefault();
          confirmDeletePassword();
        });
      }
      
      const deleteAllForm = document.getElementById('deleteAllForm');
      if (deleteAllForm) {
        deleteAllForm.addEventListener('submit', deleteAllPasswords);
      }
      
      const importForm = document.getElementById('importForm');
      if (importForm) {
        importForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const fileInput = document.getElementById('importFile');
          const passwordInput = document.getElementById('importAccountPassword');
          const progressDiv = document.getElementById('importProgress');
          
          if (!fileInput.files[0]) {
            showToast('Please select a CSV file', 'error');
            return;
          }
          
          const formData = new FormData();
          formData.append('file', fileInput.files[0]);
          formData.append('accountPassword', passwordInput.value);
          
          try {
            progressDiv.classList.remove('hidden');
            
            const response = await fetch('/import_passwords', {
              method: 'POST',
              body: formData
            });
            
            const data = await response.json();
            
            progressDiv.classList.add('hidden');
            
            if (data.success) {
              showToast(`Successfully imported ${data.imported} passwords! (${data.skipped} skipped)`, 'success');
              closeImportModal();
              
              // Update stats if provided
              if (data.stats) {
                document.getElementById('totalPasswords').textContent = data.stats.total_passwords;
                document.getElementById('weakPasswords').textContent = data.stats.weak_passwords;
                document.getElementById('securityScore').textContent = data.stats.security_score + '%';
                updateSecurityCircle(data.stats.security_score);
              }
              
              // Reload page to show imported passwords without delay
              location.reload();
            } else {
              showToast(data.error || 'Failed to import passwords', 'error');
            }
          } catch (error) {
            progressDiv.classList.add('hidden');
            console.error('Import error:', error);
            showToast('An error occurred while importing passwords', 'error');
          }
        });
      }
    });
    
    function openGeneratePasswordModal() {
      document.getElementById('generatePasswordModal').classList.remove('hidden');
      regeneratePassword();
    }
    
    function closeGeneratePasswordModal() {
      document.getElementById('generatePasswordModal').classList.add('hidden');
    }
    
    // Password visibility toggle
    function togglePasswordVisibility(inputId) {
      // If no inputId provided, default to 'password' for backward compatibility
      const input = document.getElementById(inputId || 'password');
      const icon = event.target.closest('button').querySelector('i');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    }
    
    // Generate password
    function generatePassword() {
      const length = 16;
      const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
      let password = "";
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      document.getElementById('password').value = password;
    }
    
    // Generate password for modal with options
    function regeneratePassword() {
      const length = parseInt(document.getElementById('passwordLength').value);
      const includeLetters = document.getElementById('includeLetters').checked;
      const includeNumbers = document.getElementById('includeNumbers').checked;
      const includeSymbols = document.getElementById('includeSymbols').checked;
      
      let charset = "";
      if (includeLetters) charset += "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      if (includeNumbers) charset += "0123456789";
      if (includeSymbols) charset += "!@#$%^&*()_+-=[]{}|;:,.<>?";
      
      if (charset === "") {
        showToast('Please select at least one character type', 'warning');
        return;
      }
      
      let password = "";
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      
      document.getElementById('generatedPassword').textContent = password;
    }
    
    // Copy generated password
    function copyGeneratedPassword() {
      const password = document.getElementById('generatedPassword').textContent;
      navigator.clipboard.writeText(password).then(() => {
        const btn = event.target.closest('button');
        const icon = btn.querySelector('i');
        const originalClass = icon.className;
        icon.className = 'fas fa-check';
        showToast('Password copied to clipboard!', 'success');
        setTimeout(() => {
          icon.className = originalClass;
        }, 2000);
      });
    }
    
    // Use generated password in add password form
    function useGeneratedPassword() {
      const password = document.getElementById('generatedPassword').textContent;
      document.getElementById('password').value = password;
      closeGeneratePasswordModal();
      showToast('Password inserted into form', 'success');
    }
    
    // Update length value and slider background
    document.getElementById('passwordLength')?.addEventListener('input', function() {
      document.getElementById('lengthValue').textContent = this.value;
      const percentage = ((this.value - this.min) / (this.max - this.min)) * 100;
      this.style.background = `linear-gradient(to right, var(--accent) 0%, var(--accent) ${percentage}%, var(--border) ${percentage}%, var(--border) 100%)`;
      regeneratePassword();
    });
    
    // Regenerate on checkbox change
    document.getElementById('includeLetters')?.addEventListener('change', regeneratePassword);
    document.getElementById('includeNumbers')?.addEventListener('change', regeneratePassword);
    document.getElementById('includeSymbols')?.addEventListener('change', regeneratePassword);
    
    // Update security score card color
    function updateSecurityScoreColor(score) {
      const card = document.getElementById('securityScoreCard');
      const text = document.getElementById('securityScoreText');
      const icon = document.getElementById('securityScoreIcon');
      
      if (score >= 80) {
        card.style.background = 'linear-gradient(135deg, #10B981 0%, #059669 100%)';
        text.textContent = 'Excellent protection';
        icon.className = 'fas fa-shield-alt text-3xl';
      } else if (score >= 60) {
        card.style.background = 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)';
        text.textContent = 'Good security';
        icon.className = 'fas fa-shield-alt text-3xl';
      } else if (score >= 40) {
        card.style.background = 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)';
        text.textContent = 'Fair protection';
        icon.className = 'fas fa-exclamation-triangle text-3xl';
      } else if (score >= 20) {
        card.style.background = 'linear-gradient(135deg, #EF4444 0%, #DC2626 100%)';
        text.textContent = 'Weak security';
        icon.className = 'fas fa-exclamation-circle text-3xl';
      } else {
        card.style.background = 'linear-gradient(135deg, #DC2626 0%, #991B1B 100%)';
        text.textContent = 'Critical - Action needed';
        icon.className = 'fas fa-skull-crossbones text-3xl';
      }
    }
    
    // Initialize security score color on page load
    document.addEventListener('DOMContentLoaded', function() {
      const score = parseInt(document.getElementById('security-score').textContent);
      updateSecurityScoreColor(score);
      
      // Initialize generator
      regeneratePassword();
    });

    // Settings Modal Functions
    function openSettingsModal() {
      document.getElementById('settingsModal').classList.remove('hidden');
      // Pre-fill display name with current display name from navbar
      const currentDisplayName = document.getElementById('displayName').textContent;
      document.getElementById('settingsDisplayName').value = currentDisplayName;
    }

    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.add('hidden');
      // Clear password change fields
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
    }

    // Update Display Name
    async function updateDisplayName() {
      const displayName = document.getElementById('settingsDisplayName').value.trim();
      
      if (!displayName) {
        showToast('Display name cannot be empty', 'error');
        return;
      }

      try {
        const response = await fetch('/update_display_name', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ displayName })
        });

        const data = await response.json();

        if (data.success) {
          // Update the navbar with new display name
          document.getElementById('displayName').textContent = displayName;
          showToast('Display name updated successfully', 'success');
        } else {
          showToast(data.error || 'Failed to update display name', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('An error occurred', 'error');
      }
    }

    // Handle Password Change Form
    window.addEventListener('DOMContentLoaded', function() {
      const changePasswordForm = document.getElementById('changePasswordForm');
      if (changePasswordForm) {
        changePasswordForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const currentPassword = document.getElementById('currentPassword').value;
          const newPassword = document.getElementById('newPassword').value;
          const confirmNewPassword = document.getElementById('confirmPassword').value;

          // Validation
          if (!currentPassword || !newPassword || !confirmNewPassword) {
            showToast('All password fields are required', 'error');
            return;
          }

          if (newPassword !== confirmNewPassword) {
            showToast('New passwords do not match', 'error');
            return;
          }

          if (newPassword === currentPassword) {
            showToast('New password must be different from current password', 'error');
            return;
          }

          // Check password strength
          const strength = calculatePasswordStrength(newPassword);
          if (strength.score < 2) {
            showToast('New password is too weak. Please use a stronger password.', 'warning');
            return;
          }

          try {
            showToast('Changing password and re-encrypting stored passwords...', 'info');
            
            const response = await fetch('/change_password', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                currentPassword,
                newPassword
              })
            });

            const data = await response.json();

            if (data.success) {
              showToast('Password changed successfully! Please log in again.', 'success');
              // Clear form
              changePasswordForm.reset();
              closeSettingsModal();
              // Redirect to login after 2 seconds
              setTimeout(() => {
                window.location.href = '/logout';
              }, 2000);
            } else {
              showToast(data.error || 'Failed to change password', 'error');
            }
          } catch (error) {
            console.error('Error:', error);
            showToast('An error occurred while changing password', 'error');
          }
        });
      }
    });
    
    // Close modals on backdrop click
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
      backdrop.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.add('hidden');
        }
      });
    });
    
    // Search functionality
    document.getElementById('search-input')?.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      // Search implementation would go here
    });
    
    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      
      if (newTheme === 'dark') {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      } else {
        themeIcon.classList.remove('fa-sun');
        themeIcon.classList.add('fa-moon');
      }
    }
    
    // Load saved theme
    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const body = document.body;
      const themeIcon = document.getElementById('theme-icon');
      
      body.setAttribute('data-theme', savedTheme);
      
      if (savedTheme === 'dark') {
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
      }
    });
  </script>
</body>
</html>
